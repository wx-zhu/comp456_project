---
title: "FP3 Visualization"
author: "Wenxuan Zhu"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(tidymodels)
library(ggpubr) # plot
library(caTools) # For sampling the dataset
library(randomForest) # For implementing random forest algorithm
library(naniar) # identify where NA is
library(haven) # sas7bdat file

theme_set(theme_minimal())
```

```{r}
df <- read_csv("/Users/zhuwenxuan/Desktop/STAT 456/final project/topical_data_cleaned.csv")

df_screener <- read_sas("nsch_2021_screener.sas7bdat")

# How many NA?
n_miss(df) # 5197288
prop_miss(df) # 0.4047034
# Which variables are affected?
df %>% is.na() %>% colSums()
# Which variables contain the most missing variables?
gg_miss_var(df, show_pct = TRUE) + 
  labs(title = "Look at all the missing ones :(")
```

## Kid's mental health
```{r}
# Recode severity levels
df_kid_mental <- df %>%
  select(ACE_score, K2Q31C, K2Q32C, K2Q33C) %>%
  mutate_at(vars(K2Q31C, K2Q32C, K2Q33C), # ADD/ADHD, Depression, Anxiety
    ~ ifelse(. == "1", "Mild",
      ifelse(. == "2", "Moderate",
        ifelse(. == "3", "Severe", NA))))
```

### ADD/ADHD, depression, and anxiety Boxplot
```{r fig.alt="The figure consists of multiple box plots, each representing one of the three types of kids' mental health problems: ADD/ADHD, depression, and anxiety. On the x-axis, we have the severity levels of these problems: mild, moderate, severe, and NA. The y-axis represents the range of ACE scores, which varies from 0 to 10. From the plot, across all three mental health problem types, children with severe mental health issues consistently exhibit significantly higher ACE scores compared to those with mild or moderate issues. This pattern underscores a strong association between the severity of mental health problems in children and their ACE scores, emphasizing the potential impact of adverse childhood experiences on mental health outcomes."}
# Define color-blind friendly colors
cb_color <- c("#0072B2", "#009E73", "#D55E00")

# Create the bar plot
add <- df_kid_mental %>% 
  na.omit(K2Q31C) %>% 
  ggplot(aes(y = K2Q31C, x = ACE_score, fill = K2Q31C)) +
  geom_boxplot() +
  facet_wrap(~K2Q31C, scales = "free_x", nrow = 1) +  # Facet by mental problem
  scale_fill_manual(values = cb_color) +
  labs(
    x = "ADD/ADHD",
    y = "ACE Score",
    fill = "Severity"
  ) 

dep <- df_kid_mental %>% 
  na.omit(K2Q32C) %>% 
  ggplot(aes(y = K2Q32C, x = ACE_score, fill = K2Q32C)) +
  geom_boxplot() +
  facet_wrap(~K2Q32C, scales = "free_x", nrow = 1) +  # Facet by mental problem
  scale_fill_manual(values = cb_color) +
  labs(
    x = "Depression",
    y = "ACE Score",
    fill = "Severity"
  ) 

anx <- df_kid_mental %>% 
  na.omit(K2Q33C) %>% 
  ggplot(aes(y = K2Q33C, x = ACE_score, fill = K2Q33C)) +
  geom_boxplot() +
  facet_wrap(~K2Q33C, scales = "free_x", nrow = 1) +  # Facet by mental problem
  scale_fill_manual(values = cb_color) +
  labs(
    x = "Anxiety",
    y = "ACE Score",
    fill = "Severity"
  ) 

ggarrange(add, dep, anx, 
          common.legend = TRUE,
          legend = "right",
          labels = c("A", "B", "C"),
          ncol = 1, nrow = 3)
```

The motivation for this visualization is to explore the relationship between the severity of kids' mental health problems (specifically ADD/ADHD, depression, and anxiety) and their ACE (Adverse Childhood Experiences) scores. ACE scores are a measure of the number of adverse experiences a person had during their childhood, such as abuse, neglect, or household dysfunction. Understanding this relationship is important because it can provide insights into how childhood experiences may be associated with the severity of mental health issues in children.

One of the most striking observations from the visualization is that across all three types of mental health problems, children with severe mental health issues tend to have significantly higher ACE scores compared to those with mild or moderate issues. This might suggest that children who have experienced more adverse childhood experiences are more likely to develop severe mental health problems.

### Indirect/Unclear factors to ACEs
K2Q35A_1_YEARS: How old was this child when a doctor or other health care provider FIRST told you that they had Autism, ASD, Asperger's Disorder or PDD?
K2Q36A ~ C: development delay
K2Q37A ~ C: speech disorder
K2Q40A ~ C: Asthma (哮喘)
K2Q41A ~ C: diabetes
K2Q42A ~ C: Epilepsy (癫痫)
K2Q60A ~ C: intellectual disability 
Unclear: 
CYSTFIB:  Has a doctor or other health care provider EVER told you that this child has… Cystic Fibrosis?

```{r}
df_kid_mental_indirect <- df %>%
  select(ACE_score, K2Q35A_1_YEARS, K2Q36C, K2Q37C, K2Q40C, K2Q41C, K2Q42C, K2Q60C) %>%
  mutate_at(vars(K2Q36C, K2Q37C, K2Q40C, K2Q41C, K2Q42C, K2Q60C), 
    ~ ifelse(. == "1", "Mild",
      ifelse(. == "2", "Moderate",
        ifelse(. == "3", "Severe", NA))))

colnames(df_kid_mental_indirect)[which(names(df_kid_mental_indirect) == "K2Q36C")] <- "Development_Delay"
```

```{r}
# K2Q35A_1_YEARS: How old was this child when a doctor or other health care provider FIRST told you that they had Autism, ASD, Asperger's Disorder or PDD?
df_kid_mental_indirect %>% 
  filter(!is.na(K2Q35A_1_YEARS)) %>% 
  ggplot(aes(x = factor(ACE_score), y = factor(K2Q35A_1_YEARS), color = Development_Delay)) +
  geom_count() +
  labs(x = "ACE Score", y = "Age at Initial Autism Diagnosis") +
  theme_minimal()  + 
  theme(legend.position = "right")
```



## Kids ind
```{r}

```

